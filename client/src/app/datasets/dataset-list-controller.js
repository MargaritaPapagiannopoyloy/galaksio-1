(function(){var app=angular.module("datasets.controllers.dataset-list",["ui.bootstrap","common.dialogs","datasets.dataset-list"]);app.controller("DatasetListController",function($rootScope,$scope,$http,$dialogs,APP_EVENTS){this.selectNewDatasetHandler=function(){$("#uploadDatasetSelector").click()};this.uploadDatasetHandler=function(nItem){this.removeAllowed=false;if(nItem===undefined){nItem=0}if($scope.files===undefined){this.removeAllowed=true;return}if(nItem===$scope.files.length){this.removeAllowed=true;$rootScope.$broadcast(APP_EVENTS.historyChanged);return}var file=$scope.files[nItem];if(file.state!=="pending"){this.removeAllowed=true;me.uploadDatasetHandler(nItem+1);return}var formData=new FormData;formData.append("key",window.atob(Cookies.get("galaxysession")));formData.append("inputs",'{"dbkey":"?","file_type":"auto","files_0|type":"upload_dataset","files_0|space_to_tab":null,"files_0|to_posix_lines":"Yes","files_0|NAME":"'+file.name+'"}');formData.append("files_0|file_data",file);formData.append("tool_id","upload1");formData.append("history_id",Cookies.get("current-history"));file.state="uploading";$http.post($rootScope.getRequestPath("dataset-upload"),formData,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).then(function successCallback(response){file.state="done";me.uploadDatasetHandler(nItem+1)},function errorCallback(response){file.state="error";me.uploadDatasetHandler(nItem+1);debugger;console.error("Error while uploading a new file at DatasetListController:uploadDatasetHandler.");console.error(response)})};this.deleteToUploadDatasetHandler=function(selectedItem){$("#uploadDatasetSelector").val("");for(var i in $scope.files){if($scope.files[i]===selectedItem){$scope.files.splice(i,1);return}}};this.setSelectedDatasetHandler=function(selectedItem){if(!$scope.selectedDataset){$scope.selectedDataset=[]}$scope.selectedDataset[0]=selectedItem.dataset};this.datasetSelectorAcceptButtonHandler=function(){$scope.$close($scope.selectedDataset)};this.datasetSelectorCancelButtonHandler=function(){$scope.$dismiss("cancel")};this.getDownloadLink=function(dataset_url){var fullpath=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");dataset_url.replace(fullpath,"");dataset_url=$scope.GALAXY_SERVER_URL+dataset_url;return dataset_url+"/display"};var me=this;$scope.filterDatasets=function(item){return item.deleted===false||$scope.showDeleted};$scope.maxTableHeight=window.innerHeight/2})})();